<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>逆龄算法 · 生理年龄自测</title>
    <style>
        :root {
            --ink: #1a1a1a; --gold: #b8860b; --cream: #faf8f3; --border: #e8e2d4;
        }
        body { font-family: -apple-system, sans-serif; background: var(--cream); color: var(--ink); margin: 0; }
        
        /* 页面切换逻辑：默认隐藏问卷和结果 */
        #assessment-page, #result-page { display: none; }

        .container { max-width: 600px; margin: 0 auto; padding: 20px; }
        .card { background: white; border-radius: 12px; padding: 20px; margin-bottom: 20px; border: 1px solid var(--border); }
        
        /* 题目样式 */
        .q-title { font-weight: bold; margin-bottom: 15px; font-size: 1.1rem; }
        .options { display: grid; gap: 10px; }
        .option { 
            padding: 12px; border: 1px solid var(--border); border-radius: 8px; cursor: pointer; transition: 0.3s;
        }
        .option.active { background: #f5edd8; border-color: var(--gold); }
        
        /* 进度条 */
        .progress-container { position: sticky; top: 0; background: white; padding: 10px 0; z-index: 10; border-bottom: 1px solid var(--border); }
        .progress-bar { height: 6px; background: #eee; border-radius: 3px; }
        .progress-fill { height: 100%; background: var(--gold); width: 0%; transition: 0.3s; }

        /* 按钮 */
        .btn { 
            background: var(--ink); color: white; padding: 15px 30px; border: none; border-radius: 8px; 
            width: 100%; font-size: 1rem; cursor: pointer; margin-top: 20px;
        }
        .btn:disabled { background: #ccc; cursor: not-allowed; }
        
        /* 结果展示 */
        .result-box { text-align: center; padding: 40px 0; }
        .age-display { font-size: 4rem; color: var(--gold); font-weight: bold; }
    </style>
</head>
<body>

<div id="intro-page" class="container">
    <div class="card" style="text-align: center; margin-top: 50px;">
        <h1>生理年龄测评</h1>
        <p>基于生物学算法，评估您的衰老程度</p>
        <button class="btn" onclick="goToPage('assessment-page')">开始测评</button>
    </div>
</div>

<div id="assessment-page">
    <div class="progress-container">
        <div class="container">
            <div style="display:flex; justify-content:space-between; margin-bottom:5px; font-size:12px;">
                <span>进度</span><span id="progress-text">0 / 20</span>
            </div>
            <div class="progress-bar"><div id="progress-fill" class="progress-fill"></div></div>
        </div>
    </div>

    <div class="container" id="question-list">
        </div>

    <div class="container" style="padding-bottom: 50px;">
        <div class="card" id="submit-card" style="display:none;">
            <p style="font-size: 14px; margin-bottom:15px;">
                <input type="checkbox" id="agree"> 我已确认以上信息准确无误
            </p>
            <button class="btn" id="submit-btn" onclick="calculateResult()">查看测评报告</button>
        </div>
    </div>
</div>

<div id="result-page" class="container">
    <div class="card result-box">
        <p>您的生理年龄约为</p>
        <div class="age-display" id="res-bio-age">--</div>
        <p>实际年龄: <span id="res-real-age">--</span> 岁</p>
        <button class="btn" onclick="location.reload()">重新测评</button>
    </div>
</div>

<script>
    // 题目数据：在此处按顺序添加，确保顺序不错
    const questions = [
        { id: 1, text: "与5年前相比，你的体重变化？", options: ["稳定(±2kg)", "增加超过5kg", "减轻超过5kg"], scores: [0, 2, 1] },
        { id: 2, text: "你的日常睡眠质量如何？", options: ["非常规律", "经常熬夜", "睡眠浅/易醒"], scores: [0, 2, 1] },
        { id: 3, text: "日常饮食中蔬菜摄入量？", options: ["充足", "一般", "几乎不吃"], scores: [0, 1, 2] },
        // ... 此处可继续按顺序增加到 16 题 ...
        { id: 17, text: "您的出生年份（年）", type: "input" },
        { id: 18, text: "每周运动次数？", options: ["3次以上", "1-2次", "基本不运动"], scores: [0, 1, 2] },
        { id: 19, text: "日常压力感？", options: ["较小", "适中", "很大"], scores: [0, 1, 2] },
        { id: 20, text: "吸烟/饮酒习惯？", options: ["从不", "偶尔", "经常"], scores: [0, 1, 2] }
    ];

    let userAnswers = {};
    const totalCount = questions.length;

    // 页面切换核心函数
    function goToPage(pageId) {
        document.getElementById('intro-page').style.display = 'none';
        document.getElementById('assessment-page').style.display = 'none';
        document.getElementById('result-page').style.display = 'none';
        document.getElementById(pageId).style.display = 'block';
        window.scrollTo(0, 0);
    }

    // 初始化题目
    function initQuestions() {
        const container = document.getElementById('question-list');
        questions.forEach((q, index) => {
            const card = document.createElement('div');
            card.className = 'card';
            card.id = `q-card-${q.id}`;
            
            let html = `<div class="q-title">Q${index + 1}. ${q.text}</div>`;
            
            if (q.type === 'input') {
                html += `<input type="number" class="option" style="width:100%" placeholder="例如: 1985" oninput="saveInput(${q.id}, this.value)">`;
            } else {
                html += `<div class="options">`;
                q.options.forEach((opt, i) => {
                    html += `<div class="option" onclick="saveSelect(${q.id}, ${q.scores[i]}, this)">${opt}</div>`;
                });
                html += `</div>`;
            }
            card.innerHTML = html;
            container.appendChild(card);
        });
    }

    function saveSelect(qid, score, el) {
        userAnswers[qid] = score;
        // UI 选中效果
        const options = el.parentElement.querySelectorAll('.option');
        options.forEach(o => o.classList.remove('active'));
        el.classList.add('active');
        updateProgress();
    }

    function saveInput(qid, val) {
        if (val > 1900 && val <= new Date().getFullYear()) {
            userAnswers[qid] = val;
        } else {
            delete userAnswers[qid];
        }
        updateProgress();
    }

    function updateProgress() {
        const answeredCount = Object.keys(userAnswers).length;
        const percent = (answeredCount / totalCount) * 100;
        document.getElementById('progress-fill').style.width = percent + '%';
        document.getElementById('progress-text').innerText = `${answeredCount} / ${totalCount}`;

        // 如果全部填完，显示提交按钮卡片
        if (answeredCount >= totalCount) {
            document.getElementById('submit-card').style.display = 'block';
        }
    }

    function calculateResult() {
        if (!document.getElementById('agree').checked) {
            alert("请先勾选同意选项");
            return;
        }

        const currentYear = new Date().getFullYear();
        const birthYear = parseInt(userAnswers[17]) || 1990;
        const realAge = currentYear - birthYear;
        
        // 简易逻辑：基础分 + 选项累加分
        let totalScore = 0;
        for (let id in userAnswers) {
            if (id != 17) totalScore += userAnswers[id];
        }

        const bioAge = realAge + (totalScore / 2); // 示例算法

        // 显示结果
        document.getElementById('res-bio-age').innerText = Math.round(bioAge);
        document.getElementById('res-real-age').innerText = realAge;
        goToPage('result-page');
    }

    // 页面加载后立即初始化题目
    initQuestions();
</script>

</body>
</html>
